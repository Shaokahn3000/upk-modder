Adjusting end-of-base mission stuff.

In XGDebriefUI.CheckForMatinee, the post alien base hyperwave stuff is triggered by :

            if(HQ().m_arrLastCargo[180] > 0)
            {
                PRES().UINarrative(xcomnarrativemoment'HyperWaveRetrieved',, PostHyperwaveMatinee);
                STORAGE().RemoveItem(192);
                STAT_SetStat(68, Game().GetDays());
                m_bPlayedMatinee = true;
                return true;
            }
			
This is basically triggering off of the retrieval of the eItem_HyperwaveBeacon during the base mission. Currently every base mission is set to grant one, so it should probably be set to be supplied only on the first alien base mission.

Also, the PostHyperwaveMatinee function :
function PostHyperwaveMatinee()
{
    PRES().UIObjectiveDisplay(5);
    //return;    
}

updates the objective status to objective 5, which only should happen once.

Finally, in CheckForMatinee, the skeleton key item is being removed from storage, which will prevent another base mission from being accepted after the first (unless another Outsider shard is collected). Currently only one outsider shard can ever be constructed.


Unfortunately, there is no way to guarantee that only one alien base will have the hyperwave relay item, as it's possible to spawn multiple alien bases while still on objective 4 by launching multiple satellites.

This means that the conditional in CheckForMatinee needs to be changed to testing the current objective


original hex broken down:
if(HQ().m_arrLastCargo[180] > 0)
07 D7 01 97 10 2C B4 19 1B 5C 11 00 00 00 00 00 00 16 09 00 A2 32 00 00 00 01 A2 32 00 00 25 16 

	PRES().UINarrative(xcomnarrativemoment'HyperWaveRetrieved',, PostHyperwaveMatinee)
	19 1B 12 22 00 00 00 00 00 00 16 29 00 66 FF FF FF 00 1B 27 2B 00 00 00 00 00 00 20 7D 48 00 00 4A 43 FA 21 00 00 00 00 00 00 00 00 00 00 4A 4A 4A 4A 16 

	STORAGE().RemoveItem(192)
	19 1B 23 27 00 00 00 00 00 00 16 0D 00 00 00 00 00 00 1B B0 22 00 00 00 00 00 00 2C C0 4A 16 

	STAT_SetStat(68, Game().GetDays())
	1B CE 26 00 00 00 00 00 00 24 44 19 1B 4C 0E 00 00 00 00 00 00 16 0A 00 82 41 00 00 00 1B F2 0E 00 00 00 00 00 00 16 16 

	m_bPlayedMatinee = true
	14 2D 01 2C 26 00 00 27 

	return true
	04 27 






new hex broken down:
if((HQ().m_arrLastCargo[180] > 0) && (OBJECTIVES().m_eObjective == 4))
07 D7 01 82 97 10 2C B4 19 1B 5C 11 00 00 00 00 00 00 16 09 00 A2 32 00 00 00 01 A2 32 00 00 25 16 18 26 00 9A 38 3A 19 1B DE 1F 00 00 00 00 00 00 16 09 00 E1 38 00 00 00 01 E1 38 00 00 2C 04 16 16 

		PRES().UINarrative(xcomnarrativemoment'HyperWaveRetrieved',, PostHyperwaveMatinee)
		19 1B 12 22 00 00 00 00 00 00 16 29 00 66 FF FF FF 00 1B 27 2B 00 00 00 00 00 00 20 7D 48 00 00 4A 43 FA 21 00 00 00 00 00 00 00 00 00 00 4A 4A 4A 4A 16 

		STAT_SetStat(68, STAT_GetStat(1));
		1B CE 26 00 00 00 00 00 00 24 44 1B CA 26 00 00 00 00 00 00 26 16 16 
		
		m_bPlayedMatinee = true
		14 2D 01 2C 26 00 00 27 

		return true
		04 27 

	null-ops (14 bytes)
	0B 0B 0B 0B 0B 0B 0B 0B 0B 0B 0B 0B 0B 0B 

--------------------

XGDebriefUI.CheckForMatinee  // prevent cinematic and objective updating except for first alien base mission, prevent destruction of skeleton key

original hex:
07 D7 01 97 10 2C B4 19 1B 5C 11 00 00 00 00 00 00 16 09 00 A2 32 00 00 00 01 A2 32 00 00 25 16 19 1B 12 22 00 00 00 00 00 00 16 29 00 66 FF FF FF 00 1B 27 2B 00 00 00 00 00 00 20 7D 48 00 00 4A 43 FA 21 00 00 00 00 00 00 00 00 00 00 4A 4A 4A 4A 16 19 1B 23 27 00 00 00 00 00 00 16 0D 00 00 00 00 00 00 1B B0 22 00 00 00 00 00 00 2C C0 4A 16 1B CE 26 00 00 00 00 00 00 24 44 19 1B 4C 0E 00 00 00 00 00 00 16 0A 00 82 41 00 00 00 1B F2 0E 00 00 00 00 00 00 16 16 14 2D 01 2C 26 00 00 27 04 27 

new hex:
07 D7 01 82 97 10 2C B4 19 1B 5C 11 00 00 00 00 00 00 16 09 00 A2 32 00 00 00 01 A2 32 00 00 25 16 18 26 00 9A 38 3A 19 1B DE 1F 00 00 00 00 00 00 16 09 00 E1 38 00 00 00 01 E1 38 00 00 2C 04 16 16 19 1B 12 22 00 00 00 00 00 00 16 29 00 66 FF FF FF 00 1B 27 2B 00 00 00 00 00 00 20 7D 48 00 00 4A 43 FA 21 00 00 00 00 00 00 00 00 00 00 4A 4A 4A 4A 16 1B CE 26 00 00 00 00 00 00 24 44 1B CA 26 00 00 00 00 00 00 26 16 16 14 2D 01 2C 26 00 00 27 04 27 0B 0B 0B 0B 0B 0B 0B 0B 0B 0B 0B 0B 0B 0B 












